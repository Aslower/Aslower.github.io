<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta http-equiv="content-language" content="zh-CN" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
		<meta name="keywords" content="TMaize,java"/>
		<meta name="author" content="TMaize" />
		<meta name="description" content="DAO开发模式"/>
		<link rel="icon" href="/static/img/favicon.ico" type="image/x-icon" />
		<link rel="shortcut icon" href="/static/img/favicon.ico" type="image/x-icon"/>
		<link rel="stylesheet" href="/static/css/blog.css">
		<link rel="stylesheet" href="/static/css/blog-post.css">
		<script>window.blog={contextPath:""}</script>
		<script type="text/javascript" src="/static/js/blog.js"></script>
		<title>DAO开发模式-TMaize Blog</title>
	</head>
<body>
<header class="header select-none">
    <a class="logo" title="TMaize Blog" href="/">
        <img src="/static/img/logo.jpg">
    </a>
    <a class="title" href="/">TMaize Blog</a>
    <nav class="menu">
        <a href="/">Blog</a>
        <a href="/pages/categories.html">Categories</a>
        <a href="/pages/search.html">Search</a>
        <a href="/pages/links.html">Links</a>
        <a href="/pages/chat.html">Chat</a>
        <a href="/pages/about.html">About</a>
    </nav>
    <span class="icon"></span>
</header>
	<div class="main animation-fadeUp post">
		
		<h1 class="title">DAO开发模式</h1>
		
		<div class="content"><h2 id="section">概念</h2>

<p>一般的信息系统的开发架构如下</p>

<ul>
  <li>客户层：客户端浏览器</li>
  <li>显示层：利用jsp和Servlet进行页面显示</li>
  <li>业务层：对数据层的原子性DAO操作进行整合</li>
  <li>数据层：对数据库进行原子操作，例如增删改查等等</li>
  <li>数据库</li>
</ul>

<p>DAO就是Data Access Object的简称，主要就是对数据进行操作，对应上面的层级实时数据层。
在数据操作过程中，主要是以面向接口编程为主。一般将DAO划分为下面几个部分：</p>

<ul>
  <li>VO(Value Object)：JAVABean，主要由属性和属性的getter/setter方法组成，命名一般于表名一致，属性也与表中的属性一致</li>
  <li>DatabaseConnection：用于打开和关闭数据库的类</li>
  <li>DAO接口：用于声明数据库的操作，定义数据库的原子性操作，例如增删改查等，命名如UserDao，有时在前面加上I如IUserDao表示是一个接口</li>
  <li>DAOImpl：实现DAO接口的类：但是不负责数据库的打开和关闭,命名如UserDaoImpl</li>
  <li>DAOProxy：也是实现DAO接口，主要完成数据库的打开和关闭，命名如UserService或者UserDaoProxy</li>
  <li>DAOFactory：工厂类，通过getInstance()取得DAO的实例化对象，命名为XxxFactory，如UserDaoFactory</li>
</ul>

<h2 id="dao">DAO开发</h2>

<p>项目结构如下图</p>

<p><img src="01.jpg" alt="p1" /></p>

<h3 id="userjava">User.java</h3>

<p>```java
import java.sql.Date;</p>

<p>public class User {</p>

<div class="highlighter-rouge"><pre class="highlight"><code>String name;
Date birthday;
int sex;

public String getName() {
	return name;
}
public void setName(String name) {
	this.name = name;
}
public Date getBirthday() {
	return birthday;
}
public void setBirthday(Date birthday) {
	this.birthday = birthday;
}
public int getSex() {
	return sex;
}
public void setSex(int sex) {
	this.sex = sex;
} } ```
</code></pre>
</div>

<h3 id="db-configproperties">db-config.properties</h3>

<p><code class="highlighter-rouge">
driverClass=com.mysql.jdbc.Driver
url=jdbc:mysql://127.0.0.1:3306/tian?characterEncoding=utf-8
user=root
password=123456
</code></p>

<h3 id="dbconnectionjava">DBConnection.java</h3>

<p>```java
import java.io.IOException;
import java.io.InputStream;
import java.sql.Connection;
import java.sql.DriverManager;
import java.util.Properties;</p>

<p>public class DBConnection {</p>

<div class="highlighter-rouge"><pre class="highlight"><code>private static String driverClass = null;
private static String url = null;
private static String user = null;
private static String password = null;

private Connection conn = null;

static {
	InputStream inputStream = DBConnection.class.getClassLoader().getResourceAsStream("db-config.properties");
	Properties properties = new Properties();
	try {
		properties.load(inputStream);
		driverClass = properties.getProperty("driverClass");
		url = properties.getProperty("url");
		user = properties.getProperty("user");
		password = properties.getProperty("password");
	} catch (IOException e) {
		throw new ExceptionInInitializerError("Load 'SqlConfig.properties' Error!!!");
	}
}

public DBConnection() throws Exception{
	try {
		Class.forName(driverClass);
		this.conn = DriverManager.getConnection(url, user, password);
	} catch (Exception e) {
		throw e;
	}
}

public Connection getConnection(){
	return this.conn;
}

public void close() throws Exception{
	if (this.conn!=null) {
		try {
			this.conn.close();
		} catch (Exception e) {
			throw e;
		}
	}
} } ```
</code></pre>
</div>

<h3 id="userdaojava">UserDao.java</h3>

<p>```java
import java.util.List;</p>

<p>import pojo.User;</p>

<p>public interface UserDao {</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/**
 * 加入一个用户
 * @param user 要添加的对象
 * @return 是否增加成功的标记
 * @throws Exception 如果有异常将直接抛出
 */
public boolean addUser(User user) throws Exception;

/**
 * 列出所有的用户
 * @return 所有的用户
 * @throws Exception 失败将抛出异常
 */
public List&lt;User&gt; listAll() throws Exception; } ```
</code></pre>
</div>

<h3 id="userdaoimpljava">UserDaoImpl.java</h3>

<p>```java
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.util.List;
import pojo.User;</p>

<p>public class UserDaoImpl implements UserDao{</p>

<div class="highlighter-rouge"><pre class="highlight"><code>private Connection conn = null;
private PreparedStatement pstmt;

public UserDaoImpl(Connection conn) {
	this.conn = conn;
}

@Override
public boolean addUser(User user) throws Exception {

	boolean flag = false;
	
	String sql = "insert into user(xxx,xxx,xxx) values(?,?,?)";
	this.pstmt = this.conn.prepareStatement(sql);
	
	this.pstmt.setString(1, user.getName());
	this.pstmt.setDate(2, user.getBirthday());
	this.pstmt.setInt(3, user.getSex());
	
	if (this.pstmt.executeUpdate()&gt;0) {
		flag = true;
	}
	
	//关闭
	this.pstmt.close();
	return flag;
}

@Override
public List&lt;User&gt; listAll() throws Exception {
	//实现....
	return null;
}
</code></pre>
</div>

<p>}
```</p>

<h3 id="userservicejava">UserService.java</h3>

<p>```java
import java.util.List;
import dao.UserDao;
import dao.UserDaoImpl;
import db.DBConnection;
import pojo.User;</p>

<p>public class UserService implements UserDao{</p>

<div class="highlighter-rouge"><pre class="highlight"><code>private DBConnection dbconn = null;
private UserDao dao = null;

public UserService () throws Exception{
	this.dbconn = new DBConnection();
	//用dao来代理daoimpl
	this.dao = new UserDaoImpl(this.dbconn.getConnection());
}

@Override
public boolean addUser(User user) throws Exception {
	boolean flage = false;
	
	//业务逻辑，如先检查是否存在同名用户,直接返回false拒绝出现同名用户
	
	flage = this.addUser(user);
	
	//关闭数据库连接
	this.dbconn.close();
	
	return flage;
}

@Override
public List&lt;User&gt; listAll() throws Exception {

	//业务逻辑....
	
	List&lt;User&gt; list = this.dao.listAll();
	
	//关闭数据库连接
	this.dbconn.close();
	
	return list;
}
</code></pre>
</div>

<p>}
```</p>

<h3 id="daofactoryjava">DAOFactory.java</h3>

<p>```java
import dao.UserDao;
import service.UserService;</p>

<p>public class DAOFactory {</p>

<div class="highlighter-rouge"><pre class="highlight"><code>public static UserDao getUserDaoInstance() throws Exception{
	
	return new UserService();
}
</code></pre>
</div>

<p>}
```</p>

<h3 id="userdaotestjava">UserDaoTest.java</h3>

<p>这里使用junit做测试</p>

<p>```java
import java.sql.Date;
import java.util.List;
import org.junit.Test;
import factory.DAOFactory;
import pojo.User;</p>

<p>public class UserDaoTest {</p>

<div class="highlighter-rouge"><pre class="highlight"><code>@Test
public void addUser(){
	User user = new User();
	user.setName("name");
	user.setBirthday(new Date(1996, 4, 11));
	user.setSex(0);
	try {
		DAOFactory.getUserDaoInstance().addUser(user);
	} catch (Exception e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
	}
}

@Test
public void listAllUser(){
	List&lt;User&gt; list;
	try {
		list = DAOFactory.getUserDaoInstance().listAll();
		for (User user : list) {
			System.out.println(user.toString());
		}
	} catch (Exception e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
	}
	
}
</code></pre>
</div>

<p>}
```</p>
</div>
	</div>
<footer class="footer">
    <span>Copyright © 2016 皖ICP备16016174号</span>
    <a href="/sitemap.xml">网站地图</a>
    <span>Powered by</span>
    <a href="https://github.com/TMaize/tmaize-blog">tmaize-blog</a>
    <div class="up"></div>
</footer>
<script>
    //mta.qq.com 访问统计
    var _mtac = {};
    (function() {
        var mta = document.createElement("script");
        mta.src = "http://pingjs.qq.com/h5/stats.js?v2.0.2";
        mta.setAttribute("name", "MTAH5");
        mta.setAttribute("sid", "500581966");
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(mta, s);
    })();
    //360的自动推送
    (function(){
        var src = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?0b7f3f19682121293c3e4b62c9740281":"https://jspassport.ssl.qhimg.com/11.0.1.js?0b7f3f19682121293c3e4b62c9740281";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
    })();
    //百度的自动推送
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
</body>
</html>
