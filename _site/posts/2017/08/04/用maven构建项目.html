<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta http-equiv="content-language" content="zh-CN" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
		<meta name="keywords" content="TMaize,java"/>
		<meta name="author" content="TMaize" />
		<meta name="description" content="用maven构建项目"/>
		<link rel="icon" href="/static/img/favicon.ico" type="image/x-icon" />
		<link rel="shortcut icon" href="/static/img/favicon.ico" type="image/x-icon"/>
		<link rel="stylesheet" href="/static/css/blog.css">
		<link rel="stylesheet" href="/static/css/blog-post.css">
		<script>window.blog={contextPath:""}</script>
		<script type="text/javascript" src="/static/js/blog.js"></script>
		<title>用maven构建项目-TMaize Blog</title>
	</head>
<body>
<header class="header select-none">
    <a class="logo" title="TMaize Blog" href="/">
        <img src="/static/img/logo.jpg">
    </a>
    <a class="title" href="/">TMaize Blog</a>
    <nav class="menu">
        <a href="/">Blog</a>
        <a href="/pages/categories.html">Categories</a>
        <a href="/pages/search.html">Search</a>
        <a href="/pages/links.html">Links</a>
        <a href="/pages/chat.html">Chat</a>
        <a href="/pages/about.html">About</a>
    </nav>
    <span class="icon"></span>
</header>
	<div class="main animation-fadeUp post">
		
		<h1 class="title">用maven构建项目</h1>
		
		<div class="content"><p>Maven是一个项目管理工具，它包含了一个项目对象模型 (Project Object Model)，一组标准集合，一个项目生命周期(Project Lifecycle)，一个依赖管理系统(Dependency Management System)，和用来运行定义在生命周期阶段(phase)中插件(plugin)目标(goal)的逻辑。当你使用Maven的时候，你用一个明确定义的项目对象模型来描述你的项目，然后Maven可以应用横切的逻辑，这些逻辑来自一组共享的（或者自定义的）插件。</p>

<p>此外，Maven能够很方便的帮你管理项目报告，生成站点，管理JAR文件，等等</p>

<h2 id="maven">maven基础</h2>

<h3 id="section">下载</h3>

<p>到官网<a href="http://maven.apache.org/">Apache Maven</a>去下载</p>

<h3 id="pomxml">pom.xml文件</h3>

<p>pom作为项目对象模型。通过xml表示maven项目，使用pom.xml来实现。主要描述了项目：包括配置文件；开发者需要遵循的规则，缺陷管理系统，组织和licenses，项目的url，项目的依赖性，以及其他所有的项目相关因素。</p>

<p>```xml</p>
<project>
    <modelversion>4.0.0</modelversion>
    <groupid>net.tmaize</groupid>
    <artifactid>mvn-web</artifactid>
    <version>0.0.1-SNAPSHOT</version>
    <packaging>war</packaging>

    <build>
        <plugins>
            ....
        </plugins>
    </build>
    <dependencies>
        ....
    </dependencies>
</project>
<p>```</p>

<h3 id="section-1">标准目录结构</h3>

<p>使用maven就必须遵守maven的目录结构，不然会编译失败的</p>

<p>java项目结构如下</p>

<p><code class="highlighter-rouge">
src
    main
        java
        resource
    test
        java
        resource
target
pom.xml
</code></p>

<p>web项目结构如下</p>

<p><code class="highlighter-rouge">
src
    main
        java
        resource
        webapp
        WEN-INF
            web.xml
    test
        java
        resource
target
pom.xml
</code></p>

<h3 id="section-2">常用命令</h3>

<ul>
  <li>
    <p>mvn clean</p>

    <p>将项目根目录下target目录清理掉</p>
  </li>
  <li>
    <p>mvn compile</p>

    <p>将项目中的java文件编译为class文件</p>
  </li>
  <li>
    <p>mvn test</p>

    <p>单元测试，测试类名有要求XxxxTest.java</p>

    <p>项目根目录下src/test/java目录下的单元测试类都会执行</p>
  </li>
  <li>
    <p>mvn package</p>

    <p>项目打包，生成的包在target的根目录。web项目会打成war包，java项目会打成jar包</p>
  </li>
  <li>
    <p>mvn install:安装</p>

    <p>将项目打包并安装到本地仓库，方便在其他项目上用。好处是如果项目有变动，只需要再次安装即可，其他的项目都不需要变动依赖</p>
  </li>
</ul>

<h3 id="section-3">生命周期</h3>

<p>所谓的生命周期就是在一套生命周期内，执行后面的命令前面的操作会自动执行</p>

<p>在Maven中存在三套生命周期，同时每一套生命周期相互独立互不影响</p>

<p>注意每个生命周期里面又有好多步骤，但是可以总结为下面几个主要步骤</p>

<p>CleanLifeCyle：清理生命周期,命令有clean</p>

<p>defaultLifeCyle：默认生命周期,命令有compile，test，package，install，deploy</p>

<p>siteLifeCyle：站点生命周期,命令有site</p>

<h3 id="section-4">依赖范围</h3>

<p><img src="01.png" alt="01" /></p>

<p>比如说servlet-api，在做项目的时候需要，但是把它打成war包发布到tomcat时不能把它编译进应为在tomcat里面已经有了servlet-api了，会有jar包冲突，所以要将servlet-api的依赖范围设置为provided</p>

<p><img src="02.png" alt="02" />
```</p>
<dependency>
	<groupid>javax.servlet</groupid>
	<artifactid>javax.servlet-api</artifactid>
	<version>3.0.1</version>
	<scope>provided</scope>
</dependency>
<p>```</p>

<h3 id="section-5">解决依赖冲突</h3>

<ul>
  <li>有时候jar包会有冲突。首先maven有一套自己的冲突解决方案</li>
</ul>

<ol>
  <li>
    <p>声明者优先原则 ，如果有冲突，优先用以最先依赖加进来的jar</p>
  </li>
  <li>
    <p>路径近者优先原则 直接依赖高于传递依赖</p>
  </li>
</ol>

<p>如果通过上面两个步骤无法解决依赖问题还可以手动排除依赖</p>

<ul>
  <li>或者手动排除依赖，得到自己想要的</li>
</ul>

<p>比如下图，我想使用高版本的commons-logging，但是又想把我的高版本commons-logging放在spring-webmvc后面，可以通过exclude手动排除jar包</p>

<p><img src="03.png" alt="03" /></p>

<p>```xml</p>
<dependency>
	<groupid>org.springframework</groupid>
	<artifactid>spring-webmvc</artifactid>
	<version>4.1.6.RELEASE</version>
	<exclusions>
		<exclusion>
			<groupid>commons-logging</groupid>
			<artifactid>commons-logging</artifactid>
		</exclusion>
	</exclusions>
</dependency>
<p>```</p>

<ul>
  <li>再或者使用版本锁定</li>
</ul>

<p>这样的话最终使用的jar包是我指定的哪个版本</p>

<p>```xml</p>
<dependencymanagement>
	<dependencies>
		<dependency>
			<groupid>org.springframework</groupid>
			<artifactid>spring-context</artifactid>
			<version>4.3.10.RELEASE</version>
		</dependency>
	</dependencies>
</dependencymanagement>

<dependencies>
	<dependency>
		<groupid>org.springframework</groupid>
		<artifactid>spring-context</artifactid>
	</dependency>
</dependencies>
<p>```</p>

<p>或者更规范一些,把版本集中起来，方便管理</p>

<p>```xml</p>
<properties>
	<junit-version>4.12</junit-version>
</properties>

<dependencymanagement>
	<dependencies>
		<dependency>
			<groupid>junit</groupid>
			<artifactid>junit</artifactid>
			<version>${junit-version}</version>
		</dependency>
	</dependencies>
</dependencymanagement>
<p>```</p>

<p><img src="04.jpg" alt="04" /></p>

<h3 id="section-6">小技巧</h3>

<p><code class="highlighter-rouge">mvn archetype:generate </code>插件可以使用不同的模版快速生成一个maven项目</p>

<p><code class="highlighter-rouge">mvn help:effective-pom</code> 显示项目完整的依赖</p>

<p><code class="highlighter-rouge">mvn cobertura:cobertura</code> 生成代码测试的覆盖率</p>

<p>为不同的环境配置不同的数据库连接信息</p>

<p>```xml</p>
<profiles>
	<profile>
		<id>dev</id>
		<activation>
			<!-- 代表当前为dev环境 -->
			<activebydefault>true</activebydefault>
		</activation>
		<properties>
			<url>jdbc:mysql://127.0.0.1:3306/dev?characterEncoding=utf-8</url>
		</properties>
	</profile>
	<profile>
		<id>run</id>
		<properties>
			<url>jdbc:mysql://127.0.0.1:3306/book?characterEncoding=utf-8</url>
		</properties>
	</profile>
</profiles>

<!-- 添加要过滤的目录 -->
<build>
	<resources>
		<resource>
			<directory>${project.basedir}/src/main/resources</directory>
			<filtering>true</filtering>
		</resource>
	</resources>
</build>
<p>```</p>

<p>在数据库的配置文件一行<code class="highlighter-rouge">url=${url}</code>,在项目运行的时候会根据pom中指定的环境替换<code class="highlighter-rouge">${url}</code>,只需要改变activeByDefault的位置即可</p>

<h2 id="eclipsemaven">在eclipse使用maven</h2>

<p>m2e插件，eclipse自带，只需要配置一下即可</p>

<p>默认也自带maven，一般不使用，使用自己下载的即可</p>

<h3 id="section-7">基本配置</h3>

<p>找到maven的安装目录，在conf/settings.xml里面配置本地仓库位置</p>

<p>```xml</p>
<localrepository>E:/apache-maven-3.3.9/local-repo</localrepository>
<p>```</p>

<p>在eclipse里面安装设置maven</p>

<p><img src="05.png" alt="05" /></p>

<p><img src="06.png" alt="06" /></p>

<p>刷新设文件，在本地仓库建立索引</p>

<p><img src="07.png" alt="07" /></p>

<h3 id="section-8">建立项目</h3>

<p>注意不要再建立Java Project了，要建立Maven Project</p>

<p>先选择项目位置,最上面勾选了会跳过模板选择界面，使用最简单的项目目录骨架</p>

<p><img src="08.png" alt="08" /></p>

<p>Packaging决定了是web项目还是java项目，选错了没关系，在pom.xml文件里面都可以更改的</p>

<p><img src="09.png" alt="09" /></p>

<p><img src="10.png" alt="10" /></p>

<h3 id="section-9">项目依赖/插件配置</h3>

<p>一般eclipse会自动分析pom.xml里面的依赖，并自动构建，比如下载jar文件</p>

<p>也可以在项目上右键 Maven-update project 重新构建项目,如果项目出现感叹号的时候可以重新构建一下</p>

<p><img src="11.png" alt="11" /></p>

<p>```xml</p>

<!-- 插件 -->
<build>
	<plugins>
		<plugin>
			<groupid>org.apache.maven.plugins</groupid>
			<artifactid>maven-compiler-plugin</artifactid>
			<version>3.1</version>
			<configuration>
				<source />1.8
				<target>1.8</target>
				<encoding>utf-8</encoding>
			</configuration>
		</plugin>

<!-- 依赖 -->
<dependencies>
	<dependency>
		<groupid>javax.servlet</groupid>
		<artifactid>javax.servlet-api</artifactid>
		<version>3.0.1</version>
		<scope>provided</scope>
	</dependency>
</dependencies>
```

### 项目的运行

java项目直接运行，对于web项目有下面两种方式运行

第一个Maven Build 是直接使用上次命令运行，第二个Maven Build...是输入命令运行

![12](12.jpg)

1. 直接运行tomcat:run

	maven内置了tomcat,可以直接运行

	![13](13.png)

	如果需要使用较新版本的tomcat，比如使用注解
	
	可以通过插件的方式安装tomcat7，运行命令也就变成了tomcat7:run,配置如下

	```
	<plugin>
		<groupid>org.apache.tomcat.maven</groupid>
		<artifactid>tomcat7-maven-plugin</artifactid>
		<version>2.1</version>
		<configuration>
			<path>/</path>
			<contextreloadable>true</contextreloadable>
			<uriencoding>UTF-8</uriencoding>
		</configuration>
	</plugin>
	```

2. 使用eclipse的配置好的tomcat

	build之后会有war包，可以工具会自动扫描项目里面的war包，然后部署到自己的tomcat上面

	![14](14.png)

## 通过maven对项目进行拆分

比如将web项目的三层从一个项目拆分成三个项目

每个项目完成后通过模块的方式再和主项目进行组合

主项目并不写代码，只是把依赖配置好，然后每个子模块再添加主项目这个依赖

最后运行主项目即可

1. 创建父工程(Maven Project)，配置pom.xml

2. 把父工程install到本地仓库

3. 创建子工程(Maven Module),设置选择父工程，设置打包方式为jar

4. 解决子工程间的类依赖，只需要把依赖的子项目install后再添加依赖即可

```
ssh-parent
    ssh-dao
    ssh-service
    ssh-web
```

## 私服的安装

即在本地搭建一个和apache的中心仓库很想的本地Maven仓库管理器

可以供局域网使用，先到本地仓库找jar包，再到私服找jar包，最后才到互联网上的中心仓库寻找

Nexus是一个强大的Maven仓库管理器，它极大地简化了自己内部仓库的维护和外部仓库的访问。
利用Nexus你可以只在一个地方就能够完全控制访问 和部署在你所维护仓库中的每个Artifact。
Nexus是一套“开箱即用”的系统不需要数据库，它使用文件系统加Lucene来组织数据.....
</plugins></build>
</div>
	</div>
<footer class="footer">
    <span>Copyright © 2016 皖ICP备16016174号</span>
    <a href="/sitemap.xml">网站地图</a>
    <span>Powered by</span>
    <a href="https://github.com/TMaize/tmaize-blog">tmaize-blog</a>
    <div class="up"></div>
</footer>
<script>
    //mta.qq.com 访问统计
    var _mtac = {};
    (function() {
        var mta = document.createElement("script");
        mta.src = "http://pingjs.qq.com/h5/stats.js?v2.0.2";
        mta.setAttribute("name", "MTAH5");
        mta.setAttribute("sid", "500581966");
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(mta, s);
    })();
    //360的自动推送
    (function(){
        var src = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?0b7f3f19682121293c3e4b62c9740281":"https://jspassport.ssl.qhimg.com/11.0.1.js?0b7f3f19682121293c3e4b62c9740281";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
    })();
    //百度的自动推送
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
</body>
</html>
