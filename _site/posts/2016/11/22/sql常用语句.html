<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta http-equiv="content-language" content="zh-CN" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
		<meta name="keywords" content="TMaize,sql"/>
		<meta name="author" content="TMaize" />
		<meta name="description" content="SQL常用语句"/>
		<link rel="icon" href="/static/img/favicon.ico" type="image/x-icon" />
		<link rel="shortcut icon" href="/static/img/favicon.ico" type="image/x-icon"/>
		<link rel="stylesheet" href="/static/css/blog.css">
		<link rel="stylesheet" href="/static/css/blog-post.css">
		<script>window.blog={contextPath:""}</script>
		<script type="text/javascript" src="/static/js/blog.js"></script>
		<title>SQL常用语句-TMaize Blog</title>
	</head>
<body>
<header class="header select-none">
    <a class="logo" title="TMaize Blog" href="/">
        <img src="/static/img/logo.jpg">
    </a>
    <a class="title" href="/">TMaize Blog</a>
    <nav class="menu">
        <a href="/">Blog</a>
        <a href="/pages/categories.html">Categories</a>
        <a href="/pages/search.html">Search</a>
        <a href="/pages/links.html">Links</a>
        <a href="/pages/chat.html">Chat</a>
        <a href="/pages/about.html">About</a>
    </nav>
    <span class="icon"></span>
</header>
	<div class="main animation-fadeUp post">
		
		<h1 class="title">SQL常用语句</h1>
		
		<div class="content"><h2 id="section">选择操作</h2>

<ul>
  <li>
    <p>SELECT .. FROM ..</p>

    <p>最基本的操作，指定选取的表和选取的列</p>

    <p><code class="highlighter-rouge">*</code>号表示选取所有列，或者<code class="highlighter-rouge">table.*</code>表示选择这个table的所有列</p>

    <p>注意如果不加where限定的话得到的是多张表的笛卡尔积</p>

    <p>```
  SELECT
      *
  FROM
      myorder,
      order_detail
  WHERE
      myorder.order_id = order_detail.order_id</p>

    <p>–</p>

    <p>SELECT
      order_detail.*, myorder.order_time
  FROM
      myorder, order_detail
  WHERE
      myorder.order_id = order_detail.order_id
  ```</p>
  </li>
  <li>
    <p>SELECT DISTINCT</p>

    <p>用于排除重复的行</p>

    <p>```
  SELECT <code class="highlighter-rouge">user</code>.user_name,<code class="highlighter-rouge">user</code>.user_status FROM <code class="highlighter-rouge">user</code></p>

    <p>SELECT DISTINCT <code class="highlighter-rouge">user</code>.user_name,<code class="highlighter-rouge">user</code>.user_status FROM <code class="highlighter-rouge">user</code>
  ```</p>
  </li>
  <li>
    <p>ORDER BY</p>

    <p>用于对结果集进行排序</p>

    <p><code class="highlighter-rouge">
  SELECT
      `user`.*, myorder.order_id,
      myorder.order_time
  FROM
      myorder,
      `user`
  WHERE
      myorder.user_id = `user`.user_id
  ORDER BY
      `user`.user_id ASC,
      myorder.order_time DESC
 </code></p>
  </li>
  <li>
    <p>JOIN</p>

    <p>用于多表的连接,可以使用(select .. where t1,t2,t3 where t1.xx=t2.xx and t2.xx=t3.xx)替代，不过在某些情况下效率有差异</p>

    <p>有INNER JOIN,LEFT JOIN,RIGHT JOIN,FULL OUTER JOIN几种操作</p>

    <p>INNER JOIN就是取交集，LEFT JOIN就是取左边的，如果连接的表在ON条件上有就显示，没有就显示为NULL</p>

    <p><code class="highlighter-rouge">
  SELECT
      *
  FROM
      order_detail
  INNER JOIN myorder ON order_detail.order_id = myorder.order_id
  INNER JOIN product ON product.product_id = order_detail.product_id
 </code></p>

    <p>```
  SELECT
      product.product_name,
      order_detail.order_id
  FROM
      product
  LEFT JOIN order_detail ON order_detail.product_id = product.product_id</p>

    <p>product_name	order_id
  洗衣机	            1
  洗衣机	            4
  iPhone 8	        4
  iPhone 8	        6
  投影仪	            null</p>

    <p>比如用来选取没有被买过的商品</p>

    <p>SELECT
      product.product_name
  FROM
      product
  LEFT JOIN order_detail ON order_detail.product_id = product.product_id
  WHERE ISNULL(order_detail.order_id)
  ```</p>
  </li>
  <li>
    <p>UNION</p>

    <p>用于合并两个或多个 SELECT 语句的结果集</p>

    <p>一般用于同一张表的合并，不过不同表也不会出错，不过返回的两个操作返回的列数要一样，其次在上下合并是并不会对数据类型进行检查，按照位置进行合并</p>

    <p>默认地，UNION 操作符选取不同的值。如果允许重复的值，请使用 UNION ALL</p>

    <p>UNION 结果集中的列名总是等于 UNION 中第一个 SELECT 语句中的列名</p>

    <p><code class="highlighter-rouge">
  SELECT * FROM order_detail WHERE product_id = 2
  UNION
  SELECT * FROM order_detail WHERE product_id = 3
 </code></p>
  </li>
  <li>
    <p>别名</p>

    <p>以为表名称或列名称指定别名，在进行多张表关联时不至于太混乱</p>

    <p>```
  SELECT column_name AS alias_name
  FROM table_name;</p>

    <p>SELECT w.name, w.url, a.count, a.date 
  FROM Websites AS w, access_log AS a 
  WHERE a.site_id=w.id and w.name=”菜鸟教程”;
  ```</p>
  </li>
  <li>
    <p>子查询</p>

    <p>引用其他查询的结果</p>

    <p>```
  select ename,deptno,sal
  from emp
  where deptno=(select deptno from dept where loc=’NEW YORK’)；</p>

    <p>SELECT ename,job,sal
  FROM EMP
  WHERE deptno in ( SELECT deptno FROM dept WHERE dname LIKE ‘A%’)；
  ```</p>

    <p>把结果作为一个表，一定要为结果设置别名</p>

    <p><code class="highlighter-rouge">
  SELECT * FROM(SELECT * FROM `user` WHERE `user`.user_id) AS u
 </code></p>
  </li>
  <li>
    <p>多表连接子查询做计算</p>

    <p><code class="highlighter-rouge">
  select spacesize-used from (select * from xc_tym_user u
  join xc_tym_sizetype s
  on u.sizetype_id=s.id
  where u.id=4) a,(select count(*) used from xc_tym_sizetype) b
 </code></p>
  </li>
  <li>
    <p>GROUP BY .. HAVING</p>

    <p>结果分组，之后所做的统计都是组内的统计</p>

    <p>having 相当于组组内的where</p>

    <p><code class="highlighter-rouge">
  SELECT
      A.order_id,
      SUM(
          A.product_count * B.product_price
      ) AS money
  FROM
      order_detail A
  INNER JOIN product B ON A.product_id = B.product_id
  WHERE
      A.order_id &gt; 4
  GROUP BY
      A.order_id
  HAVING
      SUM(
          A.product_count * B.product_price
      ) &gt; 500
 </code></p>
  </li>
</ul>

<h2 id="section-1">修改操作</h2>

<p>update，insert，delete都被归纳为修改操作</p>

<ul>
  <li>
    <p>insert</p>

    <p>VALUES里面值额顺序要和table里面的顺序一致</p>

    <p><code class="highlighter-rouge">
  INSERT INTO table_name
  VALUES (value1,value2,value3,...);
 </code></p>

    <p>或者直接指定为插入时为哪几个属性赋值</p>

    <p><code class="highlighter-rouge">
  INSERT INTO table_name (column1,column2,column3,...)
  VALUES (value1,value2,value3,...);
 </code></p>
  </li>
  <li>
    <p>update</p>

    <p>注意如果没有用WHERE来限定条件的话table中指定列的值都会被update</p>

    <p><code class="highlighter-rouge">
  UPDATE table_name
  SET column1=value1,column2=value2,...
  WHERE some_column=some_value;
 </code></p>
  </li>
  <li>
    <p>delete</p>

    <p>注意如果没有用WHERE来限定条件的话，所有的记录都将被删除</p>

    <p><code class="highlighter-rouge">
  DELETE FROM table_name
  WHERE some_column=some_value;
 </code></p>
  </li>
  <li>
    <p>设置外键</p>
  </li>
</ul>

</div>
	</div>
<footer class="footer">
    <span>Copyright © 2016 皖ICP备16016174号</span>
    <a href="/sitemap.xml">网站地图</a>
    <span>Powered by</span>
    <a href="https://github.com/TMaize/tmaize-blog">tmaize-blog</a>
    <div class="up"></div>
</footer>
<script>
    //mta.qq.com 访问统计
    var _mtac = {};
    (function() {
        var mta = document.createElement("script");
        mta.src = "http://pingjs.qq.com/h5/stats.js?v2.0.2";
        mta.setAttribute("name", "MTAH5");
        mta.setAttribute("sid", "500581966");
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(mta, s);
    })();
    //360的自动推送
    (function(){
        var src = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?0b7f3f19682121293c3e4b62c9740281":"https://jspassport.ssl.qhimg.com/11.0.1.js?0b7f3f19682121293c3e4b62c9740281";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
    })();
    //百度的自动推送
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
</body>
</html>
